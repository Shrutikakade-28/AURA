<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura - Complete Wellness Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #e6f3ff 0%, #f8fafc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header h1 {
            font-size: 2rem;
            margin: 0;
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 1.2rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            color: #718096;
            transition: all 0.2s;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tab-content {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #f8fafc;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .user .avatar {
            background: #667eea;
            color: white;
        }

        .bot .avatar {
            background: #e2e8f0;
            color: #667eea;
        }

        .message-content {
            max-width: 70%;
            padding: 1rem;
            border-radius: 1rem;
            line-height: 1.6;
        }

        .user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .bot .message-content {
            background: white;
            color: #1a202c;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 0.25rem;
        }

        .input-container {
            padding: 1.5rem;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 1rem;
        }

        .input-field {
            flex: 1;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #667eea;
        }

        .send-button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .send-button:hover {
            background: #5a67d8;
        }

        .send-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .wellness-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .wellness-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .wellness-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .wellness-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .wellness-icon {
            width: 48px;
            height: 48px;
            border-radius: 1rem;
            background: #e6f3ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-size: 1.5rem;
        }

        .wellness-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }

        .wellness-duration {
            color: #718096;
            font-size: 0.875rem;
        }

        .wellness-description {
            color: #718096;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .wellness-instructions {
            margin-bottom: 1rem;
        }

        .instructions-title {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }

        .instructions-list {
            color: #718096;
            padding-left: 1.5rem;
            line-height: 1.6;
        }

        .instructions-list li {
            margin-bottom: 0.5rem;
        }

        .wellness-benefits {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .benefits-title {
            font-weight: 600;
            color: #1a202c;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .benefits-text {
            color: #718096;
            font-size: 0.875rem;
            margin: 0;
        }

        .start-button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .start-button:hover {
            background: #5a67d8;
        }

        .crisis-content {
            padding: 1.5rem;
            overflow-y: auto;
        }

        .crisis-alert {
            background: #fed7d7;
            border: 2px solid #f56565;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .crisis-alert h3 {
            color: #c53030;
            margin-bottom: 1rem;
        }

        .crisis-alert p {
            color: #742a2a;
            margin-bottom: 1rem;
        }

        .crisis-button {
            background: #f56565;
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .helpline-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .helpline-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .helpline-info h3 {
            color: #1a202c;
            margin-bottom: 0.5rem;
        }

        .helpline-number {
            color: #667eea;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .helpline-details {
            color: #718096;
            font-size: 0.875rem;
        }

        .call-button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #718096;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e1;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal h2 {
            margin-bottom: 1rem;
            color: #1a202c;
        }

        .modal p {
            margin-bottom: 1rem;
            color: #718096;
        }

        .modal input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-button.primary {
            background: #667eea;
            color: white;
        }

        .modal-button.secondary {
            background: #e2e8f0;
            color: #1a202c;
        }

        @media (max-width: 768px) {
            .container {
                margin: 1rem;
                border-radius: 1rem;
                height: calc(100vh - 2rem);
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .wellness-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>üíô Aura</h1>
            </div>
            <div class="header-controls">
                <button class="control-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <button class="control-btn" id="themeBtn" title="Toggle Theme">üåô</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="chat">üí¨ Chat</button>
            <button class="tab" data-tab="wellness">üßò Wellness</button>
            <button class="tab" data-tab="crisis">üÜò Crisis Support</button>
        </div>

        <div class="content">
            <!-- Chat Tab -->
            <div class="tab-content active" id="chat">
                <div class="chat-container" id="chatContainer">
                    <div class="message bot">
                        <div class="avatar">üíô</div>
                        <div class="message-content">
                            Hi there! I'm Aura, your wellness companion. I'm here to listen, support, and help you navigate whatever you're going through. How are you feeling today?
                        </div>
                    </div>
                </div>
                <div class="input-container">
                    <input type="text" class="input-field" id="messageInput" placeholder="Type your message here..." maxlength="500">
                    <button class="send-button" id="sendButton">Send</button>
                </div>
            </div>

            <!-- Wellness Tab -->
            <div class="tab-content" id="wellness">
                <div class="wellness-grid">
                    <div class="wellness-card">
                        <div class="wellness-header">
                            <div class="wellness-icon">üå¨Ô∏è</div>
                            <div>
                                <div class="wellness-title">Box Breathing</div>
                                <div class="wellness-duration">2-5 minutes</div>
                            </div>
                        </div>
                        <div class="wellness-description">
                            A simple 4-4-4-4 breathing pattern to calm your mind and reduce stress.
                        </div>
                        <div class="wellness-instructions">
                            <div class="instructions-title">How to do it:</div>
                            <ol class="instructions-list">
                                <li>Breathe in slowly for 4 counts</li>
                                <li>Hold your breath for 4 counts</li>
                                <li>Breathe out slowly for 4 counts</li>
                                <li>Hold empty for 4 counts</li>
                                <li>Repeat this cycle</li>
                            </ol>
                        </div>
                        <div class="wellness-benefits">
                            <div class="benefits-title">Benefits:</div>
                            <div class="benefits-text">Reduces stress, improves focus, calms nervous system. Similar to pranayama practices in yoga.</div>
                        </div>
                        <button class="start-button" onclick="startExercise('box-breathing')">Start Exercise</button>
                    </div>

                    <div class="wellness-card">
                        <div class="wellness-header">
                            <div class="wellness-icon">üß†</div>
                            <div>
                                <div class="wellness-title">Body Scan Meditation</div>
                                <div class="wellness-duration">5-15 minutes</div>
                            </div>
                        </div>
                        <div class="wellness-description">
                            A gentle way to connect with your body and release tension.
                        </div>
                        <div class="wellness-instructions">
                            <div class="instructions-title">How to do it:</div>
                            <ol class="instructions-list">
                                <li>Lie down or sit comfortably</li>
                                <li>Start from your toes, notice any sensations</li>
                                <li>Slowly move your attention up through your body</li>
                                <li>Notice each part without judgment</li>
                                <li>End by taking a few deep breaths</li>
                            </ol>
                        </div>
                        <div class="wellness-benefits">
                            <div class="benefits-title">Benefits:</div>
                            <div class="benefits-text">Reduces physical tension, improves body awareness, promotes relaxation. Similar to yoga nidra practices.</div>
                        </div>
                        <button class="start-button" onclick="startExercise('body-scan')">Start Exercise</button>
                    </div>

                    <div class="wellness-card">
                        <div class="wellness-header">
                            <div class="wellness-icon">üéØ</div>
                            <div>
                                <div class="wellness-title">5-4-3-2-1 Grounding</div>
                                <div class="wellness-duration">2-3 minutes</div>
                            </div>
                        </div>
                        <div class="wellness-description">
                            A quick technique to ground yourself when feeling overwhelmed.
                        </div>
                        <div class="wellness-instructions">
                            <div class="instructions-title">How to do it:</div>
                            <ol class="instructions-list">
                                <li>Name 5 things you can see</li>
                                <li>Name 4 things you can touch</li>
                                <li>Name 3 things you can hear</li>
                                <li>Name 2 things you can smell</li>
                                <li>Name 1 thing you can taste</li>
                            </ol>
                        </div>
                        <div class="wellness-benefits">
                            <div class="benefits-title">Benefits:</div>
                            <div class="benefits-text">Reduces anxiety, brings you to present moment, helps with panic attacks. Great for exam anxiety.</div>
                        </div>
                        <button class="start-button" onclick="startExercise('grounding')">Start Exercise</button>
                    </div>
                </div>
            </div>

            <!-- Crisis Support Tab -->
            <div class="tab-content" id="crisis">
                <div class="crisis-content">
                    <div class="crisis-alert">
                        <h3>üö® Need Immediate Help?</h3>
                        <p>If you're in crisis or having thoughts of self-harm, please call a helpline immediately. These services are available 24/7 and are completely confidential.</p>
                        <a href="tel:1800-599-0019" class="crisis-button">üìû Call National Helpline: 1800-599-0019</a>
                    </div>

                    <div class="helpline-grid">
                        <div class="helpline-card">
                            <div class="helpline-info">
                                <h3>National Suicide Prevention Helpline</h3>
                                <div class="helpline-number">1800-599-0019</div>
                                <div class="helpline-details">24/7 ‚Ä¢ Free, confidential support</div>
                            </div>
                            <a href="tel:1800-599-0019" class="call-button">üìû Call</a>
                        </div>

                        <div class="helpline-card">
                            <div class="helpline-info">
                                <h3>KIRAN Mental Health Helpline</h3>
                                <div class="helpline-number">1800-599-0019</div>
                                <div class="helpline-details">24/7 ‚Ä¢ Government mental health support</div>
                            </div>
                            <a href="tel:1800-599-0019" class="call-button">üìû Call</a>
                        </div>

                        <div class="helpline-card">
                            <div class="helpline-info">
                                <h3>iCall</h3>
                                <div class="helpline-number">022-25521111</div>
                                <div class="helpline-details">Mon-Sat, 8 AM-10 PM ‚Ä¢ Professional counseling</div>
                            </div>
                            <a href="tel:022-25521111" class="call-button">üìû Call</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let geminiApiKey = '';
        let conversationHistory = [];
        let currentTab = 'chat';

        // Crisis keywords
        const crisisKeywords = ['suicide', 'kill myself', 'end it all', 'not worth living', 'harm myself', 'hurt myself', 'self harm', 'cut myself', 'overdose', 'take pills', 'jump off', 'hang myself', 'no point', 'better off dead', 'world without me', 'want to die', 'end my life', 'suicidal'];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKey();
            setupEventListeners();
            messageInput.focus();
        });

        // Event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Chat
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            // Controls
            document.getElementById('settingsBtn').addEventListener('click', showSettingsModal);
            document.getElementById('themeBtn').addEventListener('click', toggleTheme);
        }

        // Tab switching
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabName);
            });
        }

        // Chat functions
        function addMessage(content, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? 'üë§' : 'üíô';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatContainer.appendChild(messageDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = 'üíô';
            
            const typingContent = document.createElement('div');
            typingContent.className = 'message-content typing-indicator';
            typingContent.innerHTML = `
                <span>Aura is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(typingContent);
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            conversationHistory.push({ role: 'user', content: message });
            messageInput.value = '';

            // Check for crisis keywords
            if (checkForCrisis(message)) {
                setTimeout(() => {
                    removeTypingIndicator();
                    showCrisisAlert();
                }, 1500);
                return;
            }

            // Show typing indicator
            showTypingIndicator();

            try {
                // Get AI response
                const response = await getAIResponse(message);
                removeTypingIndicator();
                addMessage(response);
                conversationHistory.push({ role: 'assistant', content: response });
            } catch (error) {
                console.error('Error getting AI response:', error);
                removeTypingIndicator();
                addMessage("I apologize, but I'm having trouble responding right now. Please try again in a moment.");
            }
        }

        async function getAIResponse(userMessage) {
            if (!geminiApiKey) {
                return "Please provide your Gemini API key to enable AI responses. Click the settings button (‚öôÔ∏è) to add it.";
            }

            try {
                const prompt = `You are Aura, a compassionate AI wellness companion designed specifically for Indian youth. You provide empathetic, culturally-aware support for mental health and emotional wellbeing.

Cultural Context:
- You understand the pressures Indian youth face: academic stress, family expectations, social media, career uncertainty
- You're aware of cultural nuances around mental health discussions in Indian families
- You respect traditional values while being progressive about mental health
- You understand the importance of family, community, and academic success in Indian culture
- You're familiar with common stressors like competitive exams, arranged marriage pressures, and social expectations

Guidelines:
- Be warm, non-judgmental, and culturally sensitive
- Use simple, relatable language for young people
- Avoid clinical terminology
- Offer practical, actionable advice
- Acknowledge their feelings without minimizing them
- Suggest appropriate self-help tools when relevant
- Keep responses concise but meaningful (2-3 sentences)
- If they're feeling great, celebrate with them and offer ways to maintain positivity
- If they're struggling, provide gentle support and practical suggestions

User message: "${userMessage}"

Respond as Aura:`;

                console.log('Making Gemini API request...');
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.8,
                            maxOutputTokens: 500,
                        }
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log('API Response:', data);
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    console.error('Invalid API response structure:', data);
                    throw new Error('Invalid response from AI service');
                }
                
                return data.candidates[0].content.parts[0].text;
                
            } catch (error) {
                console.error('Detailed error:', error);
                
                // Return intelligent fallback response based on message content
                return getFallbackResponse(userMessage);
            }
        }

        // Intelligent fallback responses
        function getFallbackResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Check for positive messages
            if (message.includes('great') || message.includes('good') || message.includes('happy') || message.includes('excited') || message.includes('amazing') || message.includes('wonderful') || message.includes('fantastic') || message.includes('excellent') || message.includes('awesome') || message.includes('love') || message.includes('best') || message.includes('perfect')) {
                return "That's wonderful to hear! I'm so glad you're feeling positive today. What's contributing to your good mood? I'd love to help you maintain this positive energy!";
            }
            
            // Check for exam/study stress
            if (message.includes('exam') || message.includes('study') || message.includes('test') || message.includes('jee') || message.includes('neet') || message.includes('preparation')) {
                return "I understand exam stress can be overwhelming. You're not alone in feeling this way - many students experience this. What specific aspects of your studies are worrying you most? Remember, your worth isn't determined by exam results.";
            }
            
            // Check for family issues
            if (message.includes('family') || message.includes('parents') || message.includes('mother') || message.includes('father') || message.includes('pressure')) {
                return "Family relationships can be complex, especially with different expectations. Your feelings about this are completely valid. What's the main challenge you're facing with your family right now?";
            }
            
            // Check for social/friendship issues
            if (message.includes('friend') || message.includes('social') || message.includes('lonely') || message.includes('alone') || message.includes('isolated')) {
                return "Social relationships can be challenging, and it's completely normal to struggle with them sometimes. What's the main issue you're facing with your friends or social life?";
            }
            
            // Check for negative emotions
            if (message.includes('sad') || message.includes('angry') || message.includes('frustrated') || message.includes('disappointed') || message.includes('worried') || message.includes('anxious') || message.includes('stressed') || message.includes('overwhelmed') || message.includes('depressed')) {
                return "I can sense you're going through a difficult time. Your feelings are completely valid, and it's okay to not be okay sometimes. I'm here to listen and support you. What would help you feel a little better right now?";
            }
            
            // Default response
            return "Thank you for sharing that with me. I'm here to listen and support you. How are you feeling overall today? Is there anything specific you'd like to talk about or work on?";
        }

        function checkForCrisis(message) {
            const lowerMessage = message.toLowerCase();
            return crisisKeywords.some(keyword => lowerMessage.includes(keyword));
        }

        function showCrisisAlert() {
            const chatContainer = document.getElementById('chatContainer');
            const crisisAlert = document.createElement('div');
            crisisAlert.className = 'crisis-alert';
            crisisAlert.innerHTML = `
                <h3>üö® Crisis Support Available</h3>
                <p>I'm concerned about what you've shared. Your safety is important, and there are people who want to help.</p>
                <a href="tel:1800-599-0019" class="crisis-button">üìû Call Helpline: 1800-599-0019</a>
            `;
            chatContainer.appendChild(crisisAlert);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Settings modal
        function showSettingsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>üîë Gemini API Setup</h2>
                    <p>To enable intelligent AI responses, please provide your Gemini API key.</p>
                    <input type="password" id="apiKeyInput" placeholder="Enter your Gemini API key">
                    <div style="margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; font-size: 0.875rem;">
                        <strong>How to get your API key:</strong><br>
                        1. Go to <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a><br>
                        2. Sign in with your Google account<br>
                        3. Click "Create API Key"<br>
                        4. Copy and paste the key here
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button secondary" id="testApiKey">Test API</button>
                        <button class="modal-button secondary" id="cancelSettings">Cancel</button>
                        <button class="modal-button primary" id="saveSettings">Save</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const apiKeyInput = modal.querySelector('#apiKeyInput');
            const cancelBtn = modal.querySelector('#cancelSettings');
            const saveBtn = modal.querySelector('#saveSettings');
            const testBtn = modal.querySelector('#testApiKey');
            
            // Load existing API key
            apiKeyInput.value = geminiApiKey;
            
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            testBtn.addEventListener('click', async () => {
                const testKey = apiKeyInput.value.trim();
                if (!testKey) {
                    alert('Please enter an API key first');
                    return;
                }
                
                testBtn.textContent = 'Testing...';
                testBtn.disabled = true;
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${testKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: "Hello, this is a test message. Please respond with 'API test successful'."
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 50,
                            }
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.candidates && data.candidates[0]) {
                            alert('‚úÖ API key is working! You can now save it.');
                        } else {
                            alert('‚ùå API key is invalid or has no access to Gemini Pro');
                        }
                    } else {
                        const errorText = await response.text();
                        alert(`‚ùå API Error: ${response.status}\n\n${errorText}`);
                    }
                } catch (error) {
                    alert(`‚ùå Connection Error: ${error.message}`);
                }
                
                testBtn.textContent = 'Test API';
                testBtn.disabled = false;
            });
            
            saveBtn.addEventListener('click', () => {
                geminiApiKey = apiKeyInput.value.trim();
                localStorage.setItem('geminiApiKey', geminiApiKey);
                document.body.removeChild(modal);
                
                if (geminiApiKey) {
                    addMessage("‚úÖ Gemini AI is now enabled! I can provide intelligent, context-aware responses.", false);
                }
            });
            
            apiKeyInput.focus();
        }

        // Load API key from localStorage
        function loadApiKey() {
            const savedKey = localStorage.getItem('geminiApiKey');
            if (savedKey) {
                geminiApiKey = savedKey;
            }
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeBtn = document.getElementById('themeBtn');
            themeBtn.textContent = document.body.classList.contains('dark-theme') ? '‚òÄÔ∏è' : 'üåô';
        }

        // Wellness exercises
        function startExercise(exerciseType) {
            switch (exerciseType) {
                case 'box-breathing':
                    alert('Starting Box Breathing Exercise:\n\n1. Breathe in for 4 counts\n2. Hold for 4 counts\n3. Breathe out for 4 counts\n4. Hold empty for 4 counts\n\nRepeat this cycle for 2-5 minutes.');
                    break;
                case 'body-scan':
                    alert('Starting Body Scan Meditation:\n\n1. Lie down or sit comfortably\n2. Start from your toes, notice sensations\n3. Slowly move attention up through your body\n4. Notice each part without judgment\n5. End with a few deep breaths\n\nTake 5-15 minutes for this exercise.');
                    break;
                case 'grounding':
                    alert('Starting 5-4-3-2-1 Grounding:\n\n1. Name 5 things you can see\n2. Name 4 things you can touch\n3. Name 3 things you can hear\n4. Name 2 things you can smell\n5. Name 1 thing you can taste\n\nThis helps bring you to the present moment.');
                    break;
            }
        }
    </script>
</body>
</html>
